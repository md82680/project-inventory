{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <h1>{{ user.username }}'s Dashboard</h1>
    <p>Welcome to your dashboard. Here you can manage your projects and inventory.</p>
    
    <!-- Project List -->
    <div class="project-list">
        <select id="project-select">
            {% for project in projects %}
                <option value="{{ project.id }}">{{ project.name }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Add Project Form -->
    <div class="inventory-list">
        <button id="add-item-button" onclick="showProjectForm()">Add New Project</button>
        
        <div id="project-form" style="display: none;">
            <form id="new-project-form">
                <input type="text" id="projectname" placeholder="Project Name" required>
                <input type="text" id="expensetype" placeholder="Expense Type" required>
                <input type="number" id="expenseamount" placeholder="Amount" step="0.01" required>
                <input type="date" id="date" required>
                <button type="submit">Save Project</button>
            </form>
        </div>
    </div>

    <script>
        function showProjectForm() {
            document.getElementById('project-form').style.display = 'block';
        }

        document.getElementById('new-project-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const projectData = {
                projectname: document.getElementById('projectname').value,
                expensetype: document.getElementById('expensetype').value,
                expenseamount: parseFloat(document.getElementById('expenseamount').value),
                date: document.getElementById('date').value
            };

            fetch('/add_project', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(projectData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Project added successfully!');
                    location.reload(); // Refresh to show new project
                } else {
                    alert('Failed to add project: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to add project');
            });
        });
    </script>
{% endblock %}